---
title: "Week 1:  Review of Data Wrangling"
author: "Stat 431"
output:
  prettydoc::html_pretty:
    theme: tactile
    highlight: github
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
source("./Scripts/window_dressing.R")
quiz_url <- "https://canvas.calpoly.edu/courses/16654/quizzes/9464"
library(tidyverse)
library(flair)
```

```{css, echo = FALSE}
img {
  vertical-align:middle
}

body {
  text-shadow:none;
}


```

(Since Week 1 consists of review of Stat 331 material, you should be able to skip some of the required readings and viewings. It is your responsibility to decide which areas you need to review before diving into Stat 431.)


```{r, results = "asis", echo = FALSE}
make_summary_table(vid_time = "0-45 min", 
                   reading_time = "0-90 min", 
                   work_time = "0-45 min", 
                   canvas_activities = 3)
```

```{r, results = "asis", echo = FALSE}
extra_rec("")
```

* [RStudio Cheatsheets](https://rstudio.com/resources/cheatsheets/) are a great shortcut resource to have on hand, to remind you of which functions exist and what they do.
* The [R for Data Science Textbook](https://r4ds.had.co.nz/) is free online.
* [RStudio's Primers](https://rstudio.cloud/learn/primers) are interactive lessons on the basics of R; these would be a great way to refresh your knowledge.

## Reading Data

You should feel comfortable with:

* Reading data into R from a url.

* Downloading data locally and reading it into R.

* Dealing with `.csv` files, `.txt` files with a variety of delimiters, and Excel files.

* Handling different variable types, especially **strings** and **factors**, and adjusting them if needed.

* Using `readLines()` and/or `read_lines()` to load a file line by line.


```{r, results = "asis", echo = FALSE}
req_vid("readr and readxl", type = "Required", url = "https://www.youtube.com/embed/MTljwff_-2A")
```


```{r, results = "asis", echo = FALSE}
req_read("R4DS Chapter 11: Data Import", url = "https://r4ds.had.co.nz/data-import.html", type = "Recommended")
```



## Data Frames, Tibbles, Piping


You should feel comfortable with:

* Using the pipe operator (`%>%`)

* Describing the overall structure and contents of a data frame or tibble.

* Finding basic summary statistics for a data frame.



```{r, results = "asis", echo = FALSE}
req_vid("Data Frames and the Pipe", url="https://www.youtube.com/embed/jOd65mR1zfw")
```


```{r, results = "asis", echo = FALSE}
req_read("R4DS Chapter 10: Tibbles", url = "https://r4ds.had.co.nz/tibbles.html", type = "Recommended")
```



```{r, results = "asis", echo = FALSE}
req_read("R4DS Chapter 18: Pipes", url = "https://r4ds.had.co.nz/pipes.html", type = "Recommended")
```



## Data Transformation

You should feel comfortable:


* Using the five main `dplyr` verbs:

  * `filter()`
  
  * `arrange()`
  
  * `select()`
  
  * `mutate()`
  
  * `summarize()`

* Using `group_by()` to perform groupwise operations

* Using at least a few other `dplyr` verbs for more nuanced tasks


```{r, results = "asis", echo = FALSE}
req_read("R4DS Chapter 5: Data Transformation", url = "https://r4ds.had.co.nz/transform.html", type = "Required")
```


```{r, results = "asis", echo = FALSE}
req_vid("dplyr (short)", url="https://www.youtube.com/embed/BaFkbNOaof8")
```


```{r, results = "asis", echo = FALSE}
req_vid("dplyr (long)", url = "https://www.youtube.com/embed/Zc_ufg4uW4U", type = "Recommended")
```


```{r, results = "asis", echo = FALSE}
checkin("dplyr and piping")
```

*To get the full intended practice in this Check-In, you should try to answer these questions __WITHOUT__ actually running the code.*

Recall the world-famous `iris` dataset:

```{r}
head(iris)
```


**Question 1:**  Suppose we would like to study how the length-to-width ratio of petals differs across the species.  Rearrange the following steps in the pipeline into an order that accomplishes this goal.

```{r, include = FALSE}
iris %>%
  mutate(
    Petal.Ratio = Petal.Length/Petal.Width
  ) %>%
  group_by(Species) %>%
  summarize(
    Avg.Petal.Ratio = median(Petal.Ratio)
  ) %>%
  arrange(Avg.Petal.Ratio)

#cebda
```
```{r, eval = FALSE}

# a
arrange(Avg.Petal.Ratio)


# b
group_by(Species)

# c
iris 
  

# d
summarize(
  Avg.Petal.Ratio = median(Petal.Ratio)
)
  
# e
mutate(
  Petal.Ratio = Petal.Length/Petal.Width
)
  
```

**Question 2:** Consider the base R code below.


```{r, eval = FALSE}
mean(iris[iris$Species == "setosa", "Petal.Length"])
```

For each of the following `dplyr` pipelines, indicate if it

(i) Returns the exact same thing as the Base R code;
(ii) Returns the correct information, but the wrong object type;
(iii) Returns incorrect information; or
(iv) Returns an error

```{r, eval = FALSE}
# a
iris %>%
  filter("Petal.Length") %>%
  pull("setosa") %>%
  mean()


# b
iris %>%
  filter(Species == "setosa") %>%
  select(Petal.Length) %>%
  summarize(mean(Petal.Length))


# c
iris %>%
  pull(Petal.Length) %>%
  filter(Species == "setosa") %>%
  mean()

# d
iris %>%
  filter(Species == "setosa") %>%
  select(Petal.Length) %>%
  mean()

# e
iris %>%
  filter(Species == "setosa") %>%
  pull(Petal.Length) %>%
  mean()

# f
iris %>%
  select(Species == "setosa") %>%
  filter(Petal.Length) %>%
  summarize(mean(Petal.Length))
```



```{r, results = "asis", echo = FALSE}
canvas_task(quiz_url)
```





## Tidy Data and Combining Datasets


You should feel comfortable with:

* Understanding what it means for data to be "tidy"

* Using the `join_*()` family of functions to combine data.

* Using `bind_rows()` and `bind_cols()`, or `cbind()` and `rbind()`, to combine data.

* Using `pivot_longer()` and `pivot_wider()` to transform data.

* Finding basic summary statistics for a data frame.


```{r, results = "asis", echo = FALSE}
req_read("R4DS Chapter 12: Tidy Data", url = "https://r4ds.had.co.nz/tidy-data.html")
```

```{r, results = "asis", echo = FALSE}
req_read("Visual illustrations of join functions", url = "https://www.garrickadenbuie.com/project/tidyexplain/")
```

```{r, results = "asis", echo = FALSE}
req_vid("Tidy Data", url = "https://www.youtube.com/embed/1ELALQlO-yM", type = "Recommended")
```

(Note: This video uses `spread()` and `gather()`.  These functions are now replaced with `pivot_longer()` and `pivot_wider()`.)

```{r, results = "asis", echo = FALSE}
req_vid("Binding and Joining", url = "https://www.youtube.com/embed/AuBgYDCg1Cg", type = "Recommended")
```


```{r, results = "asis", echo = FALSE}
checkin("Pivoting")
```

```{r, include = FALSE}
us_arrests <- USArrests %>% select(-Rape)
```

Consider the following dataset, which contains information about arrests for violent crimes in each state:

```{r}
head(us_arrests)
```

**Question 1:** Consider the following code.  What does it do, and why might it be an important step before reshaping the data?

```{r, eval = FALSE}
us_arrests <- us_arrests %>%
  rownames_to_column()
```

**Question 2:**  Fill in the blanks for the code that will produce the following:

```{r pivot, include = FALSE}
us_arrests %>%
  pivot_longer(cols = Murder:Assault,
               names_to = "Crime",
               values_to = "Rate")
```

```{r, echo = FALSE}
decorate("pivot") %>%
  mask("longer", background = "#fdff32") %>%
  mask("Murder:Assault", background = "#fdff32") %>%
  mask("names_to", background = "	#fdff32") %>%
  mask("values_to", background = "#fdff32")
```




```{r, results = "asis", echo = FALSE}
canvas_task(quiz_url)
```


