---
title: "Week 2:  ggplot Extensions"
author: "Stat 431"
output:
  prettydoc::html_pretty:
    theme: tactile
    highlight: github
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
source("./Scripts/window_dressing.R")
quiz_url <- "https://canvas.calpoly.edu/courses/16654/quizzes/11716"
library(tidyverse)
library(flair)
library(lubridate)
library(gganimate)
```

```{css, echo = FALSE}
img {
  vertical-align:middle
}

body {
  text-shadow:none;
}


```


```{r, include = FALSE}
oscars <- read_csv("../GH_Classroom-Labs/Lab_1/Oscars-demographics-DFE.csv")

oscars <- oscars %>%
  select(-matches("^_")) %>%
  select(-contains("gold")) %>%
  select(-contains("confidence")) %>%
  separate(date_of_birth,
           into = c("Day", "Month", "Year"),
           sep = "-") %>%
  mutate(
    Year = as.numeric(Year),
    Year = case_when(
      Year < 100 ~ Year + 1900,
      TRUE ~ Year
    ),
    Birthdate = ymd(paste(Year, Month, Day)),
    Date_of_award = ymd(paste(year_of_award, "Feb", "01")),
    Age_at_Award = interval(Birthdate, Date_of_award)/years(1),
    Award_Gender = case_when(
      str_detect(award, "Actress") ~ "Female",
      str_detect(award, "Actor") ~ "Male",
      TRUE ~ "Ungendered"
    ),
    Decade_of_Award = round(year_of_award, digits = -1)
  )

```


```{r, results = "asis", echo = FALSE}
make_summary_table(vid_time = "21 min", 
                   reading_time = "30 min", 
                   work_time = "60 min", 
                   canvas_activities = 5)
```

```{r, results = "asis", echo = FALSE}
extra_rec("")
```

* Dave Robinson's [Tidy Tuesday Screencasts](https://www.youtube.com/user/safe4democracy/videos) show a master of Data Viz at work!
* You can also search the [Tidy Tuesday hashtag on twitter](https://twitter.com/search?q=%23TidyTuesday&src=typeahead_click) to see some great examples of data manipulating and visualization
* Don't forget about the [Data-to-Viz Website](https://www.data-to-viz.com/)
* [The "dataisbeautiful" subreddit](https://www.reddit.com/r/dataisbeautiful/top/?t=all) shares many nice visualizations.
*[This webinar](https://www.youtube.com/watch?v=0m4yywqNPVY), by ggplot contributor Thomas Lin Pedersen, is wonderful.  It's about 2 hours long - so more than we can fit in as required viewing - but if you want to become a `ggplot` master, watch this!

## Custom Colors and Themes

A huge part of making a compelling and convincing plot is your choice of color and layout.

Your first video will take you through some great core principals of visualization.  Then your two short readings will show you the basics of manipulating colors and themes in `ggplot`.


```{r, results = "asis", echo = FALSE}
req_vid("What makes a nice-looking graphic?", url = 'https://resources.rstudio.com/rstudio-conf-2020/the-glamour-of-graphics-william-chase', 
        embed = '<p><a href="https://resources.rstudio.com/rstudio-conf-2020/the-glamour-of-graphics-william-chase?wvideo=fhb2ifduim"><img src="https://embedwistia-a.akamaihd.net/deliveries/562228aa30db0e604fc4107f39af9afc.jpg?image_play_button_size=2x&amp;image_crop_resized=960x540&amp;image_play_button=1&amp;image_play_button_color=4287c7e0" width="400" height="225" style="width: 400px; height: 225px;"></a></p><p><a href="https://resources.rstudio.com/rstudio-conf-2020/the-glamour-of-graphics-william-chase?wvideo=fhb2ifduim">The Glamour of Graphics - William Chase</a></p>')
```

Or, if you prefer to click through the slides, [they are here](https://www.williamrchase.com/slides/assets/player/KeynoteDHTMLPlayer.html).


```{r, results = "asis", echo = FALSE}
req_read("Colors and Palettes", url = "https://www.datanovia.com/en/blog/ggplot-colors-best-tricks-you-will-love/")
```


```{r, results = "asis", echo = FALSE}
req_read("Themes", url = "http://www.sthda.com/english/wiki/ggplot2-themes-and-background-colors-the-3-elements")
```

```{r, results = "asis", echo = FALSE}
extra_rec("")
```
* The [`jcolors` package](https://jaredhuling.org/jcolors/) for color palettes
* The [`ggthemer` package](https://www.shanelynn.ie/themes-and-colours-for-r-ggplots-with-ggthemr/) for setting universal themes.
* [Make your own](https://emanuelaf.github.io/own-ggplot-theme.html) theme to use!

```{r, results = "asis", echo = FALSE}
checkin("Custom Colors")
```

a) Briefly explain the difference between:

* `scale_color_continuous()`
* `scale_color_discrete()`
* `scale_fill_continuous()`
* `scale_fill_discrete()`

b) Which of the above would you use to change the colors of the bars on the following plot?

```{r, echo = FALSE}
top_5 <- oscars %>%
  count(birthplace) %>%
  top_n(5, n) %>%
  pull(birthplace)

p <- oscars %>%
  filter(birthplace %in% top_5) %>%
  ggplot(aes(x = birthplace, fill = birthplace)) + 
  ggtitle("Number of Academy Award Winners from major cities") +
  geom_bar()

p
```

```{r, results = "asis", echo = FALSE}
canvas_task(quiz_url)
```

```{r, results = "asis", echo = FALSE}
checkin("Theme settings")
```

Consider the plot in Question 1.  What change was made to it in each step below?  That is, what code would go inside the function `+ theme(          )` to produce the added change?

a) 
```{r, echo = FALSE}
p <- p + 
  theme(legend.position = "none")

p
```


b)
```{r, echo = FALSE}
p <- p + 
  theme(axis.title = element_blank())

p
```

c)
```{r, echo = FALSE}
p <- p + 
  theme(panel.grid.major.x = element_blank())

p
```
```{r, results = "asis", echo = FALSE}
canvas_task(quiz_url)
```

```{r, results = "asis", echo = FALSE}
checkin("Full Themes")
```

Which built-in theme is each of the following plots?

a) 
```{r, echo = FALSE}
p + theme_classic()
```

b) 
```{r, echo = FALSE}
p + theme_bw()
```


c) 
```{r, echo = FALSE}
p + theme_dark()
```


d) 
```{r, echo = FALSE}
p + theme_void()
```

```{r, results = "asis", echo = FALSE}
canvas_task(quiz_url)
```

## gganimate

There are many, many ways to "spice up" your plots.  We will focus in on one: making your plot animated!

The best package for this, if you are using `ggplot` already, is `gganimate`.

*Note:* `gganimate` plot objects can sometimes take a long time to render.  One way to make it quicker is to change the number of frames in your gif.  Another trick is to use the [cache chunk option](https://bookdown.org/yihui/rmarkdown-cookbook/cache.html) in R Markdown, so that you don't re-render the images every time you knit your file.

```{r, results = "asis", echo = FALSE}
req_read("Intro to gganimate", url = "https://gganimate.com/articles/gganimate.html")
```

```{r, results = "asis", echo = FALSE}
req_read("Another intro to gganimate", url = "https://www.datanovia.com/en/blog/gganimate-how-to-create-plots-with-beautiful-animation-in-r/",
         type = "Recommended")
```


```{r, results = "asis", echo = FALSE}
req_vid("gganimate flipbook demo (RStudio::conf 2017)", type = "Optional", url = "hhttps://www.youtube.com/watch?v=3UY7Or0v_dI&t=76s")
```


```{r, results = "asis", echo = FALSE}
just_for_fun("Dave Robinson debuts `gganimate` at PlotCon 2016", 
             url = "https://www.youtube.com/watch?v=9Y7Y1s4-VdA")
```


```{r, results = "asis", echo = FALSE}
checkin("gganimate")
```

**Fill in the blanks for the following two `gganimate` plots**


```{r trans_state, include = FALSE, eval = FALSE}
p1 <- oscars %>%
  filter(Award_Gender != "Ungendered") %>%
  ggplot(aes(y = Age_at_Award, x = award, fill = Award_Gender)) +
  geom_boxplot() +
  ggtitle("Age of Academy Award Winners ({closest_state})") + 
  xlab("Year of Award") +
  ylab("Age at Award") +
  transition_states(Award_Gender) +
  shadow_mark(alpha = 0.3)

animate(p1, nframes = 10, fps = 5)
```



```{r trans_year, include = FALSE, eval = FALSE}
p2 <- oscars %>%
  filter(Award_Gender != "Ungendered") %>%
  ggplot(aes(x = Age_at_Award, fill = Award_Gender)) +
  geom_density(alpha = 0.5) +
  ggtitle("Age of Academy Award Winners ({frame_time}s)") + 
  xlab("Year of Award") +
  ylab("Age at Award") +
  transition_time(Decade_of_Award)

animate(p2, nframes = 9, fps = 1)
```

```{r, echo = FALSE, cache = TRUE}
decorate("trans_state") %>%
  mask("closest_state", background = "#fdff32") %>%
  mask("states", background = "#fdff32") %>%
  mask("shadow_mark", background = "#fdff32") %>%
  mask("p1 ", background = "#fdff32") %>%
  mask("nframes", background = "#fdff32") %>%
  mask("fps", background = "#fdff32")


decorate("trans_year") %>%
  mask("p2 ", background = "#fdff32") %>%
  mask("transition_time", background = "#fdff32") %>%
  mask("frame_time", background = "#fdff32") %>%
  mask("nframes", background = "#fdff32") %>%
  mask("fps", background = "#fdff32")

```

```{r, results = "asis", echo = FALSE}
canvas_task(quiz_url)
```

## Other Extensions

Although we don't have time to go in-depth on every single extension of `ggplot`, 
there are **so** many wonderful ways to up your Data Viz game.

Take a look around the links below.

```{r, results = "asis", echo = FALSE}
req_read("ggplot extension gallery", url = "https://exts.ggplot2.tidyverse.org/gallery/")
```

```{r, results = "asis", echo = FALSE}
req_read("more ggplot extension summaries", url = "https://mode.com/blog/r-ggplot-extension-packages")
```

```{r, results = "asis", echo = FALSE}
checkin("More Extensions")
```

Which extension package would you use to...
*Hint: There is more than one possible answer for each question!*

a) Visualize a **social network** using twitter data?

<!-- ggraph, ggnetwork -->

b) **Add p-values** to your side-by-side boxplot of treatment groups, showing the significance of the differences?

<!-- ggpubr, ggstatsplot -->

c) Arrange **several different plots** next to each other?

<!-- patchwork, cowplot, GGAlly -->

d) Make it so **hovering over a point** in your scatterplot shows the corresponding label?

<!-- Plotly, ggiraph -->

```{r, results = "asis", echo = FALSE}
canvas_task(quiz_url)
```